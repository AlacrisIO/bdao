<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="resources/my.css" />
<link rel="stylesheet" href="resources/reveal/css/reveal.css" />
<link rel="stylesheet" href="resources/reveal/css/theme/black.css" />
<link rel="stylesheet" href="resources/reveal/lib/css/zenburn.css" />
<link rel="stylesheet" href="resources/my.css" /></head>
<body style="background-repeat: no-repeat; background-size: 15%; background-origin: padding-box; background-position: bottom 1% right 1%; background-image: url('resources/pic/alacris_small_logo.png'); "><div class="reveal"><div class="slides"><section><table><tr><td width="10%"></td><td width="32%"><img src="resources/pic/alacris_logo.png" style="border: 0; vertical-align: top; background-color: transparent" /></td><td width="15%"></td><td><font fgcolor="#ff0000" size="7"><b>𝔹  uilding <br />
𝔻  istributed <br />
𝔸  pplications in <br />
𝕆  Caml</b></font></td></tr></table> <div align="left"><small> </small></div><p>François-René Rideau,  <em>Alacris</em></p><div align="center"><code class="ocaml">fare@alacris.io</code></div> <p>LambdaConf 2019, 2019-06-07</p><a href="https://alacrisio.github.io/bdao/"><tt>https://alacrisio.github.io/bdao/</tt></a></section><section><h1>Marshaling</h1></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Marshaling set straight</h1><div align="left">Translating data structures into byte sequences</div><div align="left">a.k.a. Serializing, Encoding, Formatting, Unparsing</div> <div align="left">Must be matched by <em>unmarshaling</em> (a.k.a. etc.)</div> <div align="left">Great sink of labor (old IBM study: 30% of code)</div><div align="left">Great fount of bugs &amp; vulnerabilities…</div></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Level 1: Processing Byte Buffers</h1><div align="left"><code class="ocaml">server: input_stream -&gt; output_stream -&gt; unit</code></div> <div align="left">Read: <code class="ocaml">let b = inbuf.(n) in if b == 1 then …</code></div><div align="left">Write: <code class="ocaml">match val with C x -&gt; outbuf.(n) = (f x) … </code></div> <div align="left">OCaml types don't help at all (but bounds checks do)</div><div align="left">Might as well use C - it'd be faster</div><!--OK, in FORTH. Let's at least pick a functional language, not a dysfunctional language--> <div align="left">&quot;Shotgun parser&quot;: parser peppered into processor</div><div align="left">Very fast... like grapeshot fired at your foot</div> <span class="fragment" data-fragment-index="1"><div align="center">LangSec: DON'T DO IT</div></span><!--Language Theoretic Security -- see talk by Meredith Patterson in a previous LambdaConf--></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Level 2: Processing JSON (or XML, etc.)</h1><div align="left"><code class="ocaml">server: json -&gt; json</code></div>  <div align="left">Dynamic type safety</div><div align="left">Might as well use Lisp - macros would help a lot</div><div align="left">Still &quot;Shotgunning&quot; structural integrity checks</div><div align="left">Somewhat slow, only so safe, painful in OCaml</div> <span class="fragment" data-fragment-index="1"><div align="left">Missing the whole point of OCaml</div></span></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Level 3: Marshaling messages by hand</h1><div align="left"><code class="ocaml">server: request -&gt; response</code></div><div align="left"><code class="ocaml">type 'a marshaler = Buffer.t -&gt; 'a -&gt; unit</code></div><div align="left"><code class="ocaml">type 'a unmarshaler = int -&gt; Bytes.t -&gt; 'a*int</code></div> <div align="left">Lots of bug-prone drudgery writing (un)parsers</div></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Level 4: Marshaling combinators</h1><div align="left"><code class="ocaml">type 'a marshaling = <br />   { marshal: 'a marshaler; unmarshal: 'a unmarshaler }</code></div><div align="left"><code class="ocaml">val marshaling2 : ('x -&gt; 'a*'b) -&gt; ('a -&gt; 'b -&gt; 'x) -&gt; <br />  
'a marshaling -&gt; 'b marshaling -&gt; 'x marshaling</code></div> <div align="left">Much less bug-prone and drudgery, but still too much</div></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Level 5: Derive marshaling from type</h1><div align="left">OCaml PPX: metaprogramming</div><div align="left">Compared to Lisp macros, quite heavy to use and not composable</div></section><section><p align="right" valign="top"><font size="4"><b>Marshaling</b></font></p><h1>Level 6: Use GADT</h1><div align="left"><code class="ocaml">server: 'a request -&gt; 'a response</code></div> <div align="left">Problem: even tougher to use with PPX</div><div align="left">Still a TBD item for us</div></section><section><h1>Conclusion</h1></section><section><p align="right" valign="top"><font size="4"><b>Conclusion</b></font></p><h1>Take Home Points (redux)</h1> <div align="left">(Mostly) Pure Functional is great for DApps</div> <div align="left">Types can guide writing and refactoring your App</div> <div align="left"></div> <div align="left">Alacris is building open-source infrastructure</div></section><section><p align="right" valign="top"><font size="4"><b>Conclusion</b></font></p><h1>The Meta-Story</h1> <div align="left">Types can be your friends or your enemies</div> <div align="left">Life is happier when they are your friends</div> <div align="left">Life is happier when type friends are less dumb</div> <div align="left">OCaml type friends are decent, could be even better</div></section><section><p align="right" valign="top"><font size="4"><b>Conclusion</b></font></p><h1>Thanks</h1> <div align="left">Our startup:   <em>Alacris</em>  <a href="https://alacris.io/"><tt>https://alacris.io/</tt></a></div> <div align="left">WE ARE EITHER HIRING OR BANKRUPT!   (No constructive proof yet.)</div> <div align="left">DO YOU HAVE EXTRA MILLIONS?   Seed capital, Research grants…</div> <div align="left">SHOW ME THE CODE!   <a href="https://github.com/AlacrisIO/legicash-facts"><tt>https://github.com/AlacrisIO/legicash-facts</tt></a></div></section></div></div>
<script src="resources/reveal/lib/js/head.min.js"></script>
<script src="resources/reveal/js/reveal.min.js"></script>
<script>
//<![CDATA[
Reveal.initialize({
  dependencies: [
    {src: "resources/reveal/plugin/highlight/highlight.js",
     async: true, callback: () => hljs.initHighlightingOnLoad()}],
  controls: false})
//]]>
</script></body></html>